# 仮想地図生成サイト（Day010）
ベクター形式で仮想地図を生成し、SVGとしてダウンロード可能にすることを目指すプロジェクト。  
現時点では、地形描画パイプラインの骨格を整理している段階。

## このプロジェクトの目的
- 目的: 仮想地図を段階的に生成する描画パイプラインを設計・実装する。
- 今回の範囲: 海岸線生成、等高線作成、色塗りの3段階。
- 今回の非範囲: 国境や国家単位の生成は一旦実施しない。

## 描画手順
1. 海岸線生成
   - 入力: 乱数シード、地形サイズ、粗さに関するパラメータ（TODO: パラメータ名を確定）
   - 出力: 島/大陸の輪郭ポリゴン
2. 等高線作成
   - 入力: 海岸線輪郭、高さ分布のルール（TODO: 生成ロジックを確定）
   - 出力: 高度ごとの線群
3. 色塗り
   - 入力: 等高線、海/陸の分類情報（TODO: 色マップ仕様を確定）
   - 出力: SVG描画用の色付きレイヤー
4. 別レイヤーで気候分布

## 実装メモ
### 海岸線の生成
3stepで生成する。
1. 大まかな構造を作成する。
   全体として、メルカトル図法のように、横長のマップにする。
   大陸の大きさもばらつきをいれる。
   左右はトーラス状にして、陸の面積と海の面積比は3:7になるように。
2. 島を作成する。
	島は大陸に被らないように。
	群島のような構造ができるように、偏りを持たせる.
3. フラクタルで細かい構造を追加する。

### 等高線の作成（プレート境界ベース）
高い山脈はプレート収束境界に優先的に作る。  
方針は `Elevation-first` ではなく `Tectonic-first` とし、標高は「境界場から合成」する。

1. 入力
- `landMask`: 最終陸マスク（海は0、陸は1）
- `coastline`: 海岸線ポリライン群
- `seed`: 乱数シード
- `contourCount`: 等高線本数

2. 前処理
- 陸マスクから「海岸距離場」を作る（海岸=0、内陸ほど増加）。
- 湖は海面と同じ基準高として扱う。
- 距離場は正規化して `coastBase` として保持する。

3. プレート境界の生成
- 2〜4本の長い境界線を生成する（折れ線またはスプライン）。
- 各境界に `convergent` / `transform` / `divergent` を付与する。
- 山脈寄与は `convergent` のみ強く与える。
- 沿岸山脈を出すため、`convergent` のうち最低1本は海岸近傍を通す。

4. 標高場の合成
- 境界線から距離減衰で `tectonicRidge` を作る（線に近いほど高い）。
- 内陸低地を作るため `basin` を減算項として追加する。
- 微細ノイズ `detailNoise` は地形骨格を壊さない弱さに制限する。
- 最終式:
  `elevation = a * coastBase + b * tectonicRidge - c * basin + d * detailNoise`

5. 等高線抽出
- 標高の閾値配列を作り、各閾値で輪郭抽出する。
- 小さすぎる閉曲線を `minLoopArea` で除去する。
- 線の頂点は Douglas-Peucker 系で簡略化する。
- 必要に応じて弱いフラクタルジッターを追加する（高標高ほど少し強める）。

6. 海岸線整合
- 海岸線を標高0として固定する。
- 等高線は必ず陸内にクリップする。
- 最初の等高線は海岸から最小オフセット距離を取る。

7. 実装ステップ（最小）
- Step A: `convergent` のみで `tectonicRidge` を作り、`coastBase` と合成。
- Step B: `basin` を追加し、中央高地化を抑制。
- Step C: `transform` / `divergent` を追加し、地形バリエーションを増やす。
- Step D: パラメータ調整UIを追加し、seed固定で比較検証。

8. 公開パラメータ案
- `contourCount`（2..12）
- `coastBaseWeight`
- `tectonicRidgeWeight`
- `basinStrength`
- `noiseStrength`
- `convergentBoundaryCount`
- `coastalConvergentChance`
- `boundaryWidthRange`
- `minLoopArea`

9. 受け入れ条件（暫定）
- 海岸線と最初の等高線が視覚的に分離される。
- 同一seedで地形が再現される。
- 1280x640で生成時間増加が現状比+40%以内。
- 海沿いの長い山脈が一定頻度で出現する。
- 大陸中央の低地が一定頻度で出現する。

## 気候
### 砂漠
- 亜熱帯砂漠
- 大陸内部砂漠
大陸の内部にできる砂漠。陸地に降る雨のほとんどは海から運ばれてきた水分だから海から遠く離れた大陸の内部では、空気が乾燥かんそうし砂漠さばくができる。
- 雨陰砂漠
大きな山脈の風下側にできる砂漠
山を上っていく途中で雨を降らせるために、山を越えた風下側では乾燥かんそうした空気となるから
- 冷涼海岸砂漠
海岸の中でも沖に冷たい寒流が流れているところにできる

### 風
1. 偏西風
2. モンスーン
大陸の中へと風がふくように

### 色塗り
- 現状方針: 高度帯ごとに色を割り当て、海と陸を別パレットで描画する。
- TODO: 色境界を滑らかに補間するか、段階色で明確に分けるかを決定する。
- TODO: SVGでの描画順序（海 -> 陸 -> 等高線）を確定する。

## TODO
- [x] 段階1を実装
- [x] 段階2の実装
- [x] 段階3を実装
- [ ] 1回の生成が重たくなってきた。ステップごとに描画し、進捗バーを置くことで体感時間を少なく
- [ ] 


## 実装方法
### 必要環境
- HTML, CSS, JS

### 出力確認方法
- TODO: 生成されたSVGの保存先を記載する。
- TODO: 最低限確認する見た目（海岸線/等高線/色塗り）を記載する。

## 参考資料
- https://www.youtube.com/watch?v=S0YB-OXlfVg
